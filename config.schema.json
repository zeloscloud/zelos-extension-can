{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "CAN Bus Configuration",
  "description": "Configure CAN interface and database file",
  "properties": {
    "interface": {
      "type": "string",
      "title": "CAN Interface",
      "description": "CAN interface type (e.g. Linux: socketcan, macOS/Windows: pcan)",
      "enum": [
        "demo",
        "virtual",
        "socketcan",
        "pcan",
        "kvaser",
        "vector",
        "other"
      ]
    }
  },
  "required": [
    "interface"
  ],
  "dependencies": {
    "interface": {
      "oneOf": [
        {
          "properties": {
            "interface": {
              "enum": [
                "demo"
              ]
            },
            "log_level": {
              "type": "string",
              "title": "Log Level",
              "description": "Set the logging verbosity level",
              "enum": [
                "DEBUG",
                "INFO",
                "WARNING",
                "ERROR",
                "CRITICAL"
              ],
              "default": "INFO"
            }
          }
        },
        {
          "properties": {
            "interface": {
              "enum": [
                "virtual"
              ]
            },
            "channel": {
              "type": "string",
              "title": "Channel",
              "description": "Virtual CAN channel identifier (e.g. vcan0)",
              "default": "vcan0"
            },
            "database_file": {
              "type": "string",
              "format": "data-url",
              "title": "CAN Database File (.dbc)",
              "description": "Upload CAN database file (supports .dbc, .arxml, .kcd, .sym)"
            },
            "receive_own_messages": {
              "type": "boolean",
              "title": "Receive Own Messages",
              "description": "Receive messages transmitted by this interface",
              "default": true
            },
            "log_raw_frames": {
              "type": "boolean",
              "title": "Log Raw CAN Frames",
              "description": "Log raw CAN frames (id, dlc, data) to separate 'can_raw' trace source",
              "default": false
            },
            "log_level": {
              "type": "string",
              "title": "Log Level",
              "description": "Set the logging verbosity level",
              "enum": [
                "DEBUG",
                "INFO",
                "WARNING",
                "ERROR",
                "CRITICAL"
              ],
              "default": "INFO"
            }
          },
          "required": [
            "channel",
            "database_file"
          ]
        },
        {
          "properties": {
            "interface": {
              "enum": [
                "socketcan"
              ]
            },
            "channel": {
              "type": "string",
              "title": "Channel",
              "description": "CAN channel identifier",
              "default": "can0"
            },
            "database_file": {
              "type": "string",
              "format": "data-url",
              "title": "CAN Database File (.dbc)",
              "description": "Upload CAN database file (supports .dbc, .arxml, .kcd, .sym)"
            },
            "fd_mode": {
              "type": "boolean",
              "title": "CAN-FD Mode",
              "description": "Enable CAN-FD for higher data rates and larger payloads",
              "default": false
            },
            "timestamp_mode": {
              "type": "string",
              "title": "Timestamp Mode",
              "description": "Hardware timestamp handling mode",
              "enum": [
                "auto",
                "absolute",
                "ignore"
              ],
              "default": "auto"
            },
            "receive_own_messages": {
              "type": "boolean",
              "title": "Receive Own Messages",
              "description": "Receive messages transmitted by this interface (useful for testing and monitoring)",
              "default": true
            },
            "log_raw_frames": {
              "type": "boolean",
              "title": "Log Raw CAN Frames",
              "description": "Log raw CAN frames (id, dlc, data) to separate 'can_raw' trace source",
              "default": false
            },
            "config_json": {
              "type": "string",
              "title": "Advanced Configuration (JSON)",
              "description": "Additional python-can Bus() kwargs as JSON object"
            },
            "log_level": {
              "type": "string",
              "title": "Log Level",
              "description": "Set the logging verbosity level",
              "enum": [
                "DEBUG",
                "INFO",
                "WARNING",
                "ERROR",
                "CRITICAL"
              ],
              "default": "INFO"
            }
          },
          "required": [
            "channel",
            "database_file"
          ],
          "dependencies": {
            "fd_mode": {
              "oneOf": [
                {
                  "properties": {
                    "fd_mode": {
                      "enum": [
                        false
                      ]
                    }
                  }
                },
                {
                  "properties": {
                    "fd_mode": {
                      "enum": [
                        true
                      ]
                    },
                    "data_bitrate": {
                      "type": "integer",
                      "title": "Data Bitrate (bps)",
                      "description": "CAN-FD data phase bitrate",
                      "enum": [
                        500000,
                        1000000,
                        2000000,
                        4000000,
                        8000000
                      ],
                      "default": 2000000
                    }
                  },
                  "required": [
                    "data_bitrate"
                  ]
                }
              ]
            }
          }
        },
        {
          "properties": {
            "interface": {
              "enum": [
                "pcan"
              ]
            },
            "channel": {
              "type": "string",
              "title": "Channel",
              "description": "CAN channel identifier",
              "default": "PCAN_USBBUS1"
            },
            "database_file": {
              "type": "string",
              "format": "data-url",
              "title": "CAN Database File (.dbc)",
              "description": "Upload CAN database file (supports .dbc, .arxml, .kcd, .sym)"
            },
            "bitrate": {
              "type": "integer",
              "title": "Bitrate (bps)",
              "description": "CAN bus bitrate",
              "enum": [
                125000,
                250000,
                500000,
                1000000
              ],
              "default": 500000
            },
            "fd_mode": {
              "type": "boolean",
              "title": "CAN-FD Mode",
              "description": "Enable CAN-FD for higher data rates and larger payloads",
              "default": false
            },
            "timestamp_mode": {
              "type": "string",
              "title": "Timestamp Mode",
              "description": "Hardware timestamp handling mode",
              "enum": [
                "auto",
                "absolute",
                "ignore"
              ],
              "default": "auto"
            },
            "receive_own_messages": {
              "type": "boolean",
              "title": "Receive Own Messages",
              "description": "Receive messages transmitted by this interface (useful for testing and monitoring)",
              "default": true
            },
            "log_raw_frames": {
              "type": "boolean",
              "title": "Log Raw CAN Frames",
              "description": "Log raw CAN frames (id, dlc, data) to separate 'can_raw' trace source",
              "default": false
            },
            "config_json": {
              "type": "string",
              "title": "Advanced Configuration (JSON)",
              "description": "Additional python-can Bus() kwargs as JSON object"
            },
            "log_level": {
              "type": "string",
              "title": "Log Level",
              "description": "Set the logging verbosity level",
              "enum": [
                "DEBUG",
                "INFO",
                "WARNING",
                "ERROR",
                "CRITICAL"
              ],
              "default": "INFO"
            }
          },
          "required": [
            "channel",
            "database_file",
            "bitrate"
          ],
          "dependencies": {
            "fd_mode": {
              "oneOf": [
                {
                  "properties": {
                    "fd_mode": {
                      "enum": [
                        false
                      ]
                    }
                  }
                },
                {
                  "properties": {
                    "fd_mode": {
                      "enum": [
                        true
                      ]
                    },
                    "data_bitrate": {
                      "type": "integer",
                      "title": "Data Bitrate (bps)",
                      "description": "CAN-FD data phase bitrate",
                      "enum": [
                        500000,
                        1000000,
                        2000000,
                        4000000,
                        8000000
                      ],
                      "default": 2000000
                    }
                  },
                  "required": [
                    "data_bitrate"
                  ]
                }
              ]
            }
          }
        },
        {
          "properties": {
            "interface": {
              "enum": [
                "kvaser"
              ]
            },
            "channel": {
              "type": "string",
              "title": "Channel",
              "description": "CAN channel identifier",
              "default": "0"
            },
            "database_file": {
              "type": "string",
              "format": "data-url",
              "title": "CAN Database File (.dbc)",
              "description": "Upload CAN database file (supports .dbc, .arxml, .kcd, .sym)"
            },
            "bitrate": {
              "type": "integer",
              "title": "Bitrate (bps)",
              "description": "CAN bus bitrate",
              "enum": [
                125000,
                250000,
                500000,
                1000000
              ],
              "default": 500000
            },
            "fd_mode": {
              "type": "boolean",
              "title": "CAN-FD Mode",
              "description": "Enable CAN-FD for higher data rates and larger payloads",
              "default": false
            },
            "timestamp_mode": {
              "type": "string",
              "title": "Timestamp Mode",
              "description": "Hardware timestamp handling mode",
              "enum": [
                "auto",
                "absolute",
                "ignore"
              ],
              "default": "auto"
            },
            "receive_own_messages": {
              "type": "boolean",
              "title": "Receive Own Messages",
              "description": "Receive messages transmitted by this interface (useful for testing and monitoring)",
              "default": true
            },
            "log_raw_frames": {
              "type": "boolean",
              "title": "Log Raw CAN Frames",
              "description": "Log raw CAN frames (id, dlc, data) to separate 'can_raw' trace source",
              "default": false
            },
            "config_json": {
              "type": "string",
              "title": "Advanced Configuration (JSON)",
              "description": "Additional python-can Bus() kwargs as JSON object"
            },
            "log_level": {
              "type": "string",
              "title": "Log Level",
              "description": "Set the logging verbosity level",
              "enum": [
                "DEBUG",
                "INFO",
                "WARNING",
                "ERROR",
                "CRITICAL"
              ],
              "default": "INFO"
            }
          },
          "required": [
            "channel",
            "database_file",
            "bitrate"
          ],
          "dependencies": {
            "fd_mode": {
              "oneOf": [
                {
                  "properties": {
                    "fd_mode": {
                      "enum": [
                        false
                      ]
                    }
                  }
                },
                {
                  "properties": {
                    "fd_mode": {
                      "enum": [
                        true
                      ]
                    },
                    "data_bitrate": {
                      "type": "integer",
                      "title": "Data Bitrate (bps)",
                      "description": "CAN-FD data phase bitrate",
                      "enum": [
                        500000,
                        1000000,
                        2000000,
                        4000000,
                        8000000
                      ],
                      "default": 2000000
                    }
                  },
                  "required": [
                    "data_bitrate"
                  ]
                }
              ]
            }
          }
        },
        {
          "properties": {
            "interface": {
              "enum": [
                "vector"
              ]
            },
            "channel": {
              "type": "string",
              "title": "Channel",
              "description": "CAN channel identifier",
              "default": "0"
            },
            "database_file": {
              "type": "string",
              "format": "data-url",
              "title": "CAN Database File (.dbc)",
              "description": "Upload CAN database file (supports .dbc, .arxml, .kcd, .sym)"
            },
            "bitrate": {
              "type": "integer",
              "title": "Bitrate (bps)",
              "description": "CAN bus bitrate",
              "enum": [
                125000,
                250000,
                500000,
                1000000
              ],
              "default": 500000
            },
            "fd_mode": {
              "type": "boolean",
              "title": "CAN-FD Mode",
              "description": "Enable CAN-FD for higher data rates and larger payloads",
              "default": false
            },
            "timestamp_mode": {
              "type": "string",
              "title": "Timestamp Mode",
              "description": "Hardware timestamp handling mode",
              "enum": [
                "auto",
                "absolute",
                "ignore"
              ],
              "default": "auto"
            },
            "receive_own_messages": {
              "type": "boolean",
              "title": "Receive Own Messages",
              "description": "Receive messages transmitted by this interface (useful for testing and monitoring)",
              "default": true
            },
            "log_raw_frames": {
              "type": "boolean",
              "title": "Log Raw CAN Frames",
              "description": "Log raw CAN frames (id, dlc, data) to separate 'can_raw' trace source",
              "default": false
            },
            "config_json": {
              "type": "string",
              "title": "Advanced Configuration (JSON)",
              "description": "Additional python-can Bus() kwargs as JSON object"
            },
            "log_level": {
              "type": "string",
              "title": "Log Level",
              "description": "Set the logging verbosity level",
              "enum": [
                "DEBUG",
                "INFO",
                "WARNING",
                "ERROR",
                "CRITICAL"
              ],
              "default": "INFO"
            }
          },
          "required": [
            "channel",
            "database_file",
            "bitrate"
          ],
          "dependencies": {
            "fd_mode": {
              "oneOf": [
                {
                  "properties": {
                    "fd_mode": {
                      "enum": [
                        false
                      ]
                    }
                  }
                },
                {
                  "properties": {
                    "fd_mode": {
                      "enum": [
                        true
                      ]
                    },
                    "data_bitrate": {
                      "type": "integer",
                      "title": "Data Bitrate (bps)",
                      "description": "CAN-FD data phase bitrate",
                      "enum": [
                        500000,
                        1000000,
                        2000000,
                        4000000,
                        8000000
                      ],
                      "default": 2000000
                    }
                  },
                  "required": [
                    "data_bitrate"
                  ]
                }
              ]
            }
          }
        },
        {
          "properties": {
            "interface": {
              "enum": [
                "other"
              ]
            },
            "database_file": {
              "type": "string",
              "format": "data-url",
              "title": "CAN Database File (.dbc)",
              "description": "Upload CAN database file (supports .dbc, .arxml, .kcd, .sym)"
            },
            "config_json": {
              "type": "string",
              "title": "Advanced Configuration (JSON)",
              "description": "Provide complete python-can Bus() kwargs as JSON. Must include 'interface' and 'channel' keys. Example: {\"interface\": \"slcan\", \"channel\": \"/dev/ttyUSB0\", \"bitrate\": 500000}"
            },
            "log_level": {
              "type": "string",
              "title": "Log Level",
              "description": "Set the logging verbosity level",
              "enum": [
                "DEBUG",
                "INFO",
                "WARNING",
                "ERROR",
                "CRITICAL"
              ],
              "default": "INFO"
            }
          },
          "required": [
            "database_file",
            "config_json"
          ]
        }
      ]
    }
  }
}
